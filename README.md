<h1 align="center">
  <img alt="SQUIDSTAT logo" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/squidstats.png" width="300px"/><br/>
  <strong>The definitive analysis for your proxy</strong>
</h1>

<div align="center">
  <!-- Banderas -->
  <a href="https://github.com/kaelthasmanu/SquidStats/blob/master/README_es.md">
    <img height="20px" src="https://img.shields.io/badge/ES-flag.svg?color=555555&style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NTAgNTAwIj4NCjxwYXRoIGZpbGw9IiNjNjBiMWUiIGQ9Im0wLDBoNzUwdjUwMGgtNzUweiIvPg0KPHBhdGggZmlsbD0iI2ZmYzQwMCIgZD0ibTAsMTI1aDc1MHYyNTBoLTc1MHoiLz4NCjwvc3ZnPg0K">
  </a>
  <a href="https://github.com/kaelthasmanu/SquidStats/blob/master/README.md">
    <img height="20px" src="https://img.shields.io/badge/EN-flag.svg?color=555555&style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgNjAgMzAiIGhlaWdodD0iNjAwIj4NCjxkZWZzPg0KPGNsaXBQYXRoIGlkPSJ0Ij4NCjxwYXRoIGQ9Im0zMCwxNWgzMHYxNXp2MTVoLTMwemgtMzB2LTE1enYtMTVoMzB6Ii8+DQo8L2NsaXBQYXRoPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzAwMjQ3ZCIgZD0ibTAsMHYzMGg2MHYtMzB6Ii8+DQo8cGF0aCBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iNiIgZD0ibTAsMGw2MCwzMG0wLTMwbC02MCwzMCIvPg0KPHBhdGggc3Ryb2tlPSIjY2YxNDJiIiBzdHJva2Utd2lkdGg9IjQiIGQ9Im0wLDBsNjAsMzBtMC0zMGwtNjAsMzAiIGNsaXAtcGF0aD0idXJsKCN0KSIvPg0KPHBhdGggc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjEwIiBkPSJtMzAsMHYzMG0tMzAtMTVoNjAiLz4NCjxwYXRoIHN0cm9rZT0iI2NmMTQyYiIgc3Ryb2tlLXdpZHRoPSI2IiBkPSJtMzAsMHYzMG0tMzAtMTVoNjAiLz4NCjwvc3ZnPg0K">
  </a>
</div>
<a name="readme-top"></a>

<h1 align="center">
  
[![GitHub repo size](https://img.shields.io/github/repo-size/kaelthasmanu/SquidStats?logo=github&style=plastic)](https://github.com/kaelthasmanu/SquidStats/)
[![GitHub License](https://img.shields.io/github/license/kaelthasmanu/SquidStats.svg?logo=github&style=plastic&colorB=68B7EB)](https://github.com/kaelthasmanu/SquidStats/blob/master/LICENSE)
[![GitHub stars](https://img.shields.io/github/stars/kaelthasmanu/SquidStats.svg?style=plastic&logo=github&color=yellow)](https://github.com/kaelthasmanu/SquidStats/stargazers) 
[![GitHub forks](https://img.shields.io/github/forks/kaelthasmanu/SquidStats.svg?logo=github&color=teal&style=plastic)](https://github.com/kaelthasmanu/SquidStats/members)
[![GitHub top language](https://img.shields.io/github/languages/top/kaelthasmanu/SquidStats?logo=github&style=plastic&color=blueviolet)](https://github.com/kaelthasmanu/SquidStats/)
[![GitHub contributors](https://img.shields.io/github/contributors/kaelthasmanu/SquidStats?logo=github&style=plastic)](https://github.com/kaelthasmanu/SquidStats/)
[![Watchers](https://img.shields.io/github/watchers/kaelthasmanu/SquidStats?logo=github&color=teal&style=plastic)](https://github.com/kaelthasmanu/SquidStats/watchers)  
</h1> 
<h4 align="center">:star: Give me one star ‚Äî it will motivate me to keep improving it!!</h4>
<!-- TABLE OF CONTENTS -->
<details>
  <summary>Table of contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About the Project</a>
      <ul>
        <li><a href="#goals-of-this-project-">Goals of this project</a></li>
      </ul>
    </li>
    <li>
      <a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#installation-script">Installation Script</a></li>
        <li><a href="#installation-manual">Installation Manual</a></li>
        <li><a href="#testing-information">Testing Information</a></li>
        <li><a href="#uninstall-squidstats">Uninstall SquidStats</a></li>
      </ul>
    </li>
    <li><a href="#to-do">To do</a></li>
    <li><a href="#contributing">Contributing</a></li>
    <li><a href="#license">License</a></li>
    <li><a href="#contact">Contact</a></li>
    <li><a href="#technologies-used">Technologies Used</a></li>
    <li><a href="#special-thanks">Special thanks</a></li>
  </ol>
</details>

<!-- ABOUT THE PROJECT -->

## About the Project

_A modern tool for parsing and analyzing Squid logs, providing a sleek and user-friendly dashboard to visualize real-time connection data. This project helps network administrators monitor and manage Squid proxy connections effectively._

**You can view the example [here](https://github.com/kaelthasmanu/SquidStats/tree/main/assets "Examples").**

<div align="center">
  <img src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/photo_2025-03-16_10-33-06.jpg" 
       alt="fig1" 
       width="65%" 
       style="min-width: 300px; max-width: 800px; border: 1px solid #ddd; border-radius: 6px;"/>
</div>
<div align="center">
  <img src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/photo_2025-04-04_15-45-33.jpg" 
       alt="fig2" 
       width="65%" 
       style="min-width: 300px; max-width: 800px; border: 1px solid #ddd; border-radius: 6px;"/>
</div>
<div align="center">
  <img src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/photo_2025-04-21_02-13-38.jpg" 
       alt="fig3" 
       width="65%" 
       style="min-width: 300px; max-width: 800px; border: 1px solid #ddd; border-radius: 6px;"/>
</div>

### Goals of this project :

- **_Real-time Log Parsing_**: Parses active Squid connections and displays detailed information.
- **_User Monitoring_**: Identifies connections by username, URI, and log type.
- **_Metrics Overview_**:
  - Total read and written data for each connection.
  - Number of requests per connection.
  - Delay pool usage.
- **_Interactive Dashboard_**: Clean interface for easy data interpretation.
- **_Squid Cache Statistics_**:
  - Stored entries.
  - Used and free capacity
  - Maximum and current cache size
  - Disk space and inode usage
  - Age of cached objects
- **_Logs Users_**:
  - User activity monitoring üë•
  - Beautiful visualizations üìä
  - Advanced filtering & search üîç
  - Paginated results üìÑ
- **_Top Graphs_**:
  - Top 20 Users Activity
  - Top 20 Users Data Usage
  - Total Users
  - Total Transmitted Data
  - Total Request
  - And More...
- **_And More_**

## <a href="#readme-top"><img align="right" border="0" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/up_arrow.png" width="22" ></a>

<!-- GETTING STARTED -->

## Getting Started

[![SquidStat](https://img.shields.io/badge/Web-Project-teal.svg?colorA=teal&colorB=red&style=for-the-badge)](https://github.com/kaelthasmanu/SquidStats/)

**The entire installation process in more detail can be found [here](https://www.sysadminsdecuba.com/2025/04/squidstat-analizador-de-logs-de-squid-diferente-y-100-cubano/).**

### Prerequisites

- Python 3.10+
- Squid proxy server

```bash
apt install git python3 python3-pip python3-venv libmariadb-dev curl
```

> **Note:** If your Squid proxy **does not use user authentication** (i.e., you do not use login or password for clients), you can keep the **default log format** that comes with Squid. The detailed format below is only required for full compatibility with user-based reports.

- ‚ö†Ô∏è !!Important ‚ö†Ô∏è For compatibility with user logs, use this format in /etc/squid/squid.conf:

```bash
  logformat detailed \
  "%ts.%03tu %>a %ui %un [%tl] \"%rm %ru HTTP/%rv\" %>Hs %<st %rm %ru %>a %mt %<a %<rm %Ss/%Sh %<st

  access_log /var/log/squid/access.log detailed
```

#### üîß Cache Manager Configuration (Critical for SquidStats)

**SquidStats requires proper Cache Manager configuration to function correctly.** Please follow the [official Squid Cache Manager documentation](https://wiki.squid-cache.org/Features/CacheManager/Index) for complete setup.

**Essential Configuration Steps:**

1. **Configure Cache Manager Access Controls** in `/etc/squid/squid.conf`:
   ```bash
   # Allow localhost access to cache manager
   acl manager proto cache_object
   acl localhost src 127.0.0.1/32 ::1
   
   # Basic cache manager access
   http_access allow localhost manager
   http_access deny manager
   ```

2. **Configure Remote Access** (if SquidStats runs on different server):
   ```bash
   # Replace 192.168.1.100 with your SquidStats server IP
   acl managerAdmin src 192.168.1.100
   http_access allow managerAdmin manager
   ```

3. **Verify Cache Manager is Working**:
   ```bash
   # Test cache manager access
   curl http://127.0.0.1:3128/squid-internal-mgr/menu
   
   # Or using squidclient
   squidclient -h 127.0.0.1 -p 3128 mgr:info
   ```

**Why This Configuration is Critical:**

- **Real-time Statistics**: SquidStats uses Cache Manager to retrieve live proxy statistics, active connections, and performance metrics
- **Cache Information**: Provides data about cached objects, memory usage, disk utilization, and hit ratios
- **Connection Monitoring**: Enables monitoring of active client connections and bandwidth usage
- **Administrative Functions**: Allows SquidStats to perform cache management operations like cache refresh and statistics retrieval

**‚ö†Ô∏è Security Note:** The Cache Manager provides sensitive information about your proxy server. Always restrict access to trusted IP addresses and consider using authentication for production environments.

**Common Issues Without Proper Configuration:**
- Empty or missing statistics in SquidStats dashboard
- "Connection refused" errors when accessing cache data
- Missing real-time connection information
- Incomplete bandwidth and user activity reports

### Installation Script

1. Get Script With curl o wget:

```bash
 wget https://github.com/kaelthasmanu/SquidStats/releases/download/1.0/install.sh
```

2. Add permission execution:

```bash
 sudo chmod +x install.sh
```

3. Execute the script:

```bash
 sudo ./install.sh
```

#### Installation Options
The installer now supports multiple modes:

```bashAdd commentMore actions
# Full installation (interactive)
sudo ./install.sh

# Update existing installation
sudo ./install.sh --update

# Configure blacklist only
sudo ./install.sh --configure-blacklist

# Show help
./install.sh --help
```

#### üõ°Ô∏è Blacklist Configuration
During installation, you can configure which domains notify like block:

- **Option 1**: Use default blacklist (facebook.com, twitter.com, instagram.com, etc.)
- **Option 2**: Configure custom domains
- **Option 3**: Skip blacklist configuration

**Example custom configuration:**
```bash
# When prompted, enter domains separated by commas:
facebook.com,twitter.com,youtube.com,netflix.com,tiktok.com
```

## <a href="#readme-top"><img align="right" border="0" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/up_arrow.png" width="22" ></a>

### Installation Manual

1. Clone the repository:
   ```bash
   mkdir -p /opt/squidstats
   git clone https://github.com/kaelthasmanu/SquidStats.git /opt/squidstats
   ```
2. Creating a virtual environment (venv):

```bash
 cd /opt/squidstats/
 python3 -m venv "/opt/squidstats/venv"
 source venv/bin/activate
 pip install --upgrade pip
```

3. Install requeriments python with pip or pip3:

```bash
  pip install -r /opt/squidstats/requirements.txt
```

4. Create a .env file in the project root and add the following content:\
    Note: for use MARIADB need your own database running
   ```bash
   VERSION=2
   SQUID_HOST="127.0.0.1"
   SQUID_PORT=3128
   FLASK_DEBUG=True
   DATABASE_TYPE="SQLITE"
   SQUID_LOG="/var/log/squid/access.log"
   DATABASE_STRING_CONNECTION="/opt/SquidStats/"
   REFRESH_INTERVAL=60
   BLACKLIST_DOMAINS="facebook.com,twitter.com,instagram.com,tiktok.com,youtube.com,netflix.com"
   HTTP_PROXY=""
   SQUID_CONFIG_PATH=/home/manuel/Desktop/config/squid.conf
   ACL_FILES_DIR=/home/manuel/Desktop/config/acls
   ```
5. Run App with python or python3 üöÄ:

```bash
  python3 app.py
```

6. With your preferred browser, visit the installation URL:

```bash
  http://ip/hostname:5000
```

### ‚ö†Ô∏è First Execution Alert ‚ö†Ô∏è

Warning: üö® The first execution may cause high CPU usage.

### Update project(web) with Script

1. Get Script With curl o wget:

```bash
 wget https://github.com/kaelthasmanu/SquidStats/releases/download/1.0/install.sh
```

2. Add permission execution:

```bash
 sudo chmod +x install.sh
```

3. Execute the script with parameters update:

```bash
 sudo ./install.sh --update
```

üïí Run on System Startup
To ensure the application starts automatically when the system boot :

1. Copy file service:

```bash
  cp ./utils/squidstats.service /etc/systemd/system/squidstats.service
```

2. Restart daemons:

```bash
  systemctl daemon-reload
```

3. Enable service:

```bash
  systemctl enable squidstats.service
```

3. Start service:

```bash
  systemctl start squidstats.service
```

## <a href="#readme-top"><img align="right" border="0" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/up_arrow.png" width="22" ></a>

## Testing Information

This software has been thoroughly tested and is compatible with Squid version 6.12 in Ubuntu 24.04 and Debian12. Please ensure your Squid installation matches this version or newer for optimal performance.

## Uninstall SquidStats

The installation script now includes a complete uninstall option that cleans all system components:

### Using the Uninstall Script

1. Get the installation script (if you don't have it):

```bash
wget https://github.com/kaelthasmanu/SquidStats/releases/download/1.0/install.sh
chmod +x install.sh
```

2. Run the uninstallation:

```bash
sudo ./install.sh --uninstall
```

### What Does the Uninstall Do?

The **COMPLETE** uninstallation performs the following actions:

- **üõë Stops and disables** the systemd service `squidstats.service`
- **üóëÔ∏è Removes files** from the `/opt/squidstats` directory
- **‚ö†Ô∏è Requires confirmation** from user before proceeding

### Manual Uninstallation

If you prefer to uninstall manually:

```bash
# Stop and disable service
sudo systemctl stop squidstats.service
sudo systemctl disable squidstats.service
sudo rm -f /etc/systemd/system/squidstats.service
sudo systemctl daemon-reload

# Remove project files
sudo rm -rf /opt/squidstats
```

### ‚ö†Ô∏è Important Note about Uninstallation

- Uninstallation will **permanently delete** all SquidStats data and configurations
- It's recommended to **backup** any custom configurations before uninstalling
- Squid configuration will be restored from the automatic backup created during installation

## To do

_Future functionalities and planned improvements._

### Upcoming Features

- **Interface Improvements** üé®
  - Customizable dashboards
  - Report export (PDF, Excel)
  - Real-time notifications

- **Security Features** üîí
  - User authentication
  - System audit logs
  - Automated alerts

- **Optimization and Performance** ‚ö°
  - Enhanced data caching
  - Historical log compression
  - Complete RESTful API
  - Multi-proxy support

## Contributing

1. Fork the repository:
   ```bash
   git checkout -b feature-name
   ```
   2.Create a new branch for your feature or fix:

```bash
git checkout -b feature-name
```

3.Commit your changes and push the branch:

```bash
git push origin feature-name
```

4.Open a pull request.

**Contributors**

<table style="width:100%">
  <tr>
    <th><b>Kaelthas</b></th>
    <th><b>Alexminator</b></th>
  </tr>
  <tr>
    <td align="center"><a href="https://github.com/kaelthasmanu"><img src="https://avatars.githubusercontent.com/u/39976595?v=4" width=150px height=150px alt="kaelthasmanu"/></a></td>
    <td align="center"><a href="https://github.com/alexminator"><img src="https://avatars.githubusercontent.com/u/9116486?s=400&v=4" width=150px height=150px alt="alexminator"/></a></td>
  </tr>
  <tr>
    <td align="center"></a> <a href="https://www.linkedin.com/in/manuel-gorrin-095242238/"><img src="assets/linkedin-48.png" width="32px" height="32px"></a><a href="https://t.me/king_0f_deathhh"><img src="assets/telegram-app-48.png" width="32px" height="32px"></a></td>
    <td align="center"><a href="https://twitter.com/alexminator99"><img src="assets/x_48.png" width="32px" height="32px"></a> <a href="https://www.linkedin.com/in/alexander-rivas-73532037/"><img src="assets/linkedin-48.png" width="32px" height="32px"></a><a href="https://t.me/Alexminator"><img src="assets/telegram-app-48.png" width="32px" height="32px"></a></td>
  </tr>
</table>

## License

_The SquidStats project is released under the <a href="https://github.com/kaelthasmanu/SquidStats/blob/master/LICENSE.md">MIT</a> license._

<!-- CONTACT -->

## Contact

> **_Need help?_**
> **_Feel free to contact me üì® [manuelalberto.gorrin@gmail.com](mailto:manuelalberto.gorrin@gmail.com?Subject=SquidStats_issues)_**

Related project: ([CuCuota](https://github.com/kaelthasmanu/cucuota))

## Technologies Used

Backend: Python, Flask  
Frontend: HTML, CSS, JavaScript

## Special thanks

- _To the Cuban Sysadmins community._
- _To everyone who gave me his help when I had doubts._

## <a href="#readme-top"><img align="right" border="0" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/up_arrow.png" width="22" ></a>
