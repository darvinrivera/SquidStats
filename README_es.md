<h1 align="center">
  <img alt="SQUIDSTAT logo" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/squidstats.png" width="300px"/><br/>
  <strong>El an√°lisis definitivo para tu proxy</strong>
</h1>

<div align="center">
  <!-- Banderas -->
  <a href="https://github.com/kaelthasmanu/SquidStats/blob/master/README_es.md">
    <img height="20px" src="https://img.shields.io/badge/ES-flag.svg?color=555555&style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NTAgNTAwIj4NCjxwYXRoIGZpbGw9IiNjNjBiMWUiIGQ9Im0wLDBoNzUwdjUwMGgtNzUweiIvPg0KPHBhdGggZmlsbD0iI2ZmYzQwMCIgZD0ibTAsMTI1aDc1MHYyNTBoLTc1MHoiLz4NCjwvc3ZnPg0K">
  </a>
  <a href="https://github.com/kaelthasmanu/SquidStats/blob/master/README.md">
    <img height="20px" src="https://img.shields.io/badge/EN-flag.svg?color=555555&style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgNjAgMzAiIGhlaWdodD0iNjAwIj4NCjxkZWZzPg0KPGNsaXBQYXRoIGlkPSJ0Ij4NCjxwYXRoIGQ9Im0zMCwxNWgzMHYxNXp2MTVoLTMwemgtMzB2LTE1enYtMTVoMzB6Ii8+DQo8L2NsaXBQYXRoPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzAwMjQ3ZCIgZD0ibTAsMHYzMGg2MHYtMzB6Ii8+DQo8cGF0aCBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iNiIgZD0ibTAsMGw2MCwzMG0wLTMwbC02MCwzMCIvPg0KPHBhdGggc3Ryb2tlPSIjY2YxNDJiIiBzdHJva2Utd2lkdGg9IjQiIGQ9Im0wLDBsNjAsMzBtMC0zMGwtNjAsMzAiIGNsaXAtcGF0aD0idXJsKCN0KSIvPg0KPHBhdGggc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjEwIiBkPSJtMzAsMHYzMG0tMzAtMTVoNjAiLz4NCjxwYXRoIHN0cm9rZT0iI2NmMTQyYiIgc3Ryb2tlLXdpZHRoPSI2IiBkPSJtMzAsMHYzMG0tMzAtMTVoNjAiLz4NCjwvc3ZnPg0K">
  </a>
</div>
<a name="readme-top"></a>

<h1 align="center">
  
[![GitHub repo size](https://img.shields.io/github/repo-size/kaelthasmanu/SquidStats?logo=github&style=plastic)](https://github.com/kaelthasmanu/SquidStats/)
[![GitHub License](https://img.shields.io/github/license/kaelthasmanu/SquidStats.svg?logo=github&style=plastic&colorB=68B7EB)](https://github.com/kaelthasmanu/SquidStats/blob/master/LICENSE)
[![GitHub stars](https://img.shields.io/github/stars/kaelthasmanu/SquidStats.svg?style=plastic&logo=github&color=yellow)](https://github.com/kaelthasmanu/SquidStats/stargazers) 
[![GitHub forks](https://img.shields.io/github/forks/kaelthasmanu/SquidStats.svg?logo=github&color=teal&style=plastic)](https://github.com/kaelthasmanu/SquidStats/members)
[![GitHub top language](https://img.shields.io/github/languages/top/kaelthasmanu/SquidStats?logo=github&style=plastic&color=blueviolet)](https://github.com/kaelthasmanu/SquidStats/)
[![GitHub contributors](https://img.shields.io/github/contributors/kaelthasmanu/SquidStats?logo=github&style=plastic)](https://github.com/kaelthasmanu/SquidStats/)
[![Watchers](https://img.shields.io/github/watchers/kaelthasmanu/SquidStats?logo=github&color=teal&style=plastic)](https://github.com/kaelthasmanu/SquidStats/watchers)  
</h1> 
<h4 align="center">:star: Dame una estrella ‚Äî me motivar√° a seguir mejor√°ndolo!</h4>
<!-- TABLE OF CONTENTS -->
<details>
  <summary>Tabla de Contenido</summary>
  <ol>
    <li>
       <a href="#sobre-el-proyecto">Sobre el proyecto</a>
      <ul>
        <li><a href="#metas">Metas</a></li>
      </ul>
    </li>
    <li>
      <a href="#comencemos">Comencemos</a>
      <ul>
        <li><a href="#prerequisitos">Prerequisitos</a></li>
        <li><a href="#instalaci√≥n-con-script">Instalaci√≥n con Script</a></li>
        <li><a href="#instalaci√≥n-manual">Instalaci√≥n manual</a></li>
        <li><a href="#informaci√≥n-de-prueba">Informaci√≥n de prueba</a></li>
      </ul>
    </li>
    <li><a href="#por-hacer">Por hacer</a></li>
    <li><a href="#colaboradores">Colaboradores</a></li>
    <li><a href="#licencia">Licencia</a></li>
    <li><a href="#contacto">Contacto</a></li>
    <li><a href="#tecnologias-usadas">Tecnolog√≠as usadas</a></li>
    <li><a href="#agradecimientos">Agradecimientos</a></li>
  </ol>
</details>

<!-- ABOUT THE PROJECT -->
## Sobre el proyecto

*Una herramienta moderna para analizar los registros de Squid, que ofrece un panel de control elegante e intuitivo para visualizar los datos de conexi√≥n en tiempo real. Este proyecto ayuda a los administradores de red a supervisar y gestionar eficazmente las conexiones proxy de Squid.*

**Puede ver ejemplos [aqu√≠](https://github.com/kaelthasmanu/SquidStats/tree/main/assets "Examples").**
<div align="center">
  <img src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/photo_2025-03-16_10-33-06.jpg" 
       alt="fig1" 
       width="65%" 
       style="min-width: 300px; max-width: 800px; border: 1px solid #ddd; border-radius: 6px;"/>
</div>
<div align="center">
  <img src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/photo_2025-04-04_15-45-33.jpg" 
       alt="fig2" 
       width="65%" 
       style="min-width: 300px; max-width: 800px; border: 1px solid #ddd; border-radius: 6px;"/>
</div>
<div align="center">
  <img src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/photo_2025-04-21_02-13-38.jpg" 
       alt="fig3" 
       width="65%" 
       style="min-width: 300px; max-width: 800px; border: 1px solid #ddd; border-radius: 6px;"/>
</div>

### Metas

- **_An√°lisis de registros en tiempo real_**: Analiza las conexiones activas de Squid y muestra informaci√≥n detallada.
- **_Monitoreo de usuarios_**: Identifica las conexiones por nombre de usuario, URI y tipo de registro.
- **_Resumen de m√©tricas_**:
  - Total de datos le√≠dos y escritos por cada conexi√≥n.
  - N√∫mero de solicitudes por conexi√≥n.
  - Uso del grupo de retardos.
- **_Panel interactivo_**: Interfaz clara para una f√°cil interpretaci√≥n de los datos.
- **_Estad√≠sticas de cach√© de Squid_**:
  - Entradas almacenadas. - Capacidad usada y libre
  - Tama√±o m√°ximo y actual de cach√©
  - Uso de espacio en disco e inodos
  - Antig√ºedad de los objetos en cach√©
- **_Registros de usuarios_**:
  - Monitoreo de la actividad del usuario üë•
  - Visualizaciones atractivas üìä
  - Filtrado y b√∫squeda avanzados üîç
  - Resultados paginados üìÑ
- **_Gr√°ficos principales_**:
  - Actividad de los 20 usuarios principales
  - Uso de datos de los 20 usuarios principales
  - Total de usuarios
  - Total de datos transmitidos
  - Total de solicitudes
- **_Y m√°s_**
  
<a href="#readme-top"><img align="right" border="0" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/up_arrow.png" width="22" ></a>
---
<!-- GETTING STARTED -->
## Comencemos
[![SquidStat](https://img.shields.io/badge/Web-Project-teal.svg?colorA=teal&colorB=red&style=for-the-badge)](https://github.com/kaelthasmanu/SquidStats/)

**El proceso de instalaci√≥n completo con m√°s detalle se puede encontrar [aqu√≠](https://www.sysadminsdecuba.com/2025/04/squidstat-analizador-de-logs-de-squid-diferente-y-100-cubano/).**

### Prerequisitos

- Python 3.10+
- Servidor proxy Squid 
- `squidclient` instalado en su servidor

```bash 
apt install git python3 python3-pip python3-venv python3-pymysql libmariadb-dev curl
```

- ‚ö†Ô∏è !!Importante ‚ö†Ô∏è Para compatibilidad con los registros de usuarios, utilice este formato en /etc/squid/squid.conf:

```bash 
  logformat detailed \
  "%ts.%03tu %>a %ui %un [%tl] \"%rm %ru HTTP/%rv\" %>Hs %<st %rm %ru %>a %mt %<a %<rm %Ss/%Sh %<st
  
  access_log /var/log/squid/access.log detailed
```

#### üîß Configuraci√≥n del Cache Manager (Cr√≠tico para SquidStats)

**SquidStats requiere una configuraci√≥n adecuada del Cache Manager para funcionar correctamente.** Por favor siga la [documentaci√≥n oficial del Cache Manager de Squid](https://wiki.squid-cache.org/Features/CacheManager/Index) para una configuraci√≥n completa.

**Pasos de Configuraci√≥n Esenciales:**

1. **Configurar Controles de Acceso al Cache Manager** en `/etc/squid/squid.conf`:
   ```bash
   # Permitir acceso localhost al cache manager
   acl manager proto cache_object
   acl localhost src 127.0.0.1/32 ::1
   
   # Acceso b√°sico al cache manager
   http_access allow localhost manager
   http_access deny manager
   ```

2. **Establecer Contrase√±a del Cache Manager** (opcional pero recomendado):
   ```bash
   # Establecer contrase√±a para acciones administrativas
   cachemgr_passwd tu_contrase√±a_aqui shutdown
   cachemgr_passwd tu_contrase√±a_aqui info stats/objects
   ```

3. **Configurar Acceso Remoto** (si SquidStats se ejecuta en un servidor diferente):
   ```bash
   # Reemplazar 192.168.1.100 con la IP de su servidor SquidStats
   acl managerAdmin src 192.168.1.100
   http_access allow managerAdmin manager
   ```

4. **Verificar que el Cache Manager Funciona**:
   ```bash
   # Probar acceso al cache manager
   curl http://127.0.0.1:3128/squid-internal-mgr/menu
   
   # O usando squidclient
   squidclient -h 127.0.0.1 -p 3128 mgr:info
   ```

**Por qu√© Esta Configuraci√≥n es Cr√≠tica:**

- **Estad√≠sticas en Tiempo Real**: SquidStats usa el Cache Manager para obtener estad√≠sticas en vivo del proxy, conexiones activas y m√©tricas de rendimiento
- **Informaci√≥n de Cach√©**: Proporciona datos sobre objetos cacheados, uso de memoria, utilizaci√≥n de disco y ratios de aciertos
- **Monitoreo de Conexiones**: Permite monitorear conexiones activas de clientes y uso de ancho de banda
- **Funciones Administrativas**: Permite a SquidStats realizar operaciones de gesti√≥n de cach√© como actualizaci√≥n de cach√© y obtenci√≥n de estad√≠sticas

**‚ö†Ô∏è Nota de Seguridad:** El Cache Manager proporciona informaci√≥n sensible sobre su servidor proxy. Siempre restrinja el acceso a direcciones IP confiables y considere usar autenticaci√≥n para entornos de producci√≥n.

**Problemas Comunes Sin Configuraci√≥n Adecuada:**
- Estad√≠sticas vac√≠as o faltantes en el dashboard de SquidStats
- Errores de "Conexi√≥n rechazada" al acceder a datos de cach√©
- Informaci√≥n de conexi√≥n en tiempo real faltante
- Reportes incompletos de ancho de banda y actividad de usuarios
### Instalaci√≥n con Script

1. Obtener el script con curl o wget:

```bash
 wget https://github.com/kaelthasmanu/SquidStats/releases/download/0.2/install.sh
``` 

2. Dar permisos de ejecuci√≥n:

```bash
 sudo chmod +x install.sh
```

3. Ejecutar el script:

```bash
 sudo ./install.sh
```

#### Opciones de Instalaci√≥n
El instalador ahora soporta m√∫ltiples modos:

```bash
# Instalaci√≥n completa (interactiva)
sudo ./install.sh

# Actualizar instalaci√≥n existente
sudo ./install.sh --update

# Configurar solo blacklist
sudo ./install.sh --configure-blacklist

# Mostrar ayuda
./install.sh --help
```

#### üõ°Ô∏è Configuraci√≥n de Blacklist
Durante la instalaci√≥n, puede configurar qu√© dominios notificar como bloqueados:

- **Opci√≥n 1**: Usar blacklist predeterminada (facebook.com, twitter.com, instagram.com, etc.)
- **Opci√≥n 2**: Configurar dominios personalizados
- **Opci√≥n 3**: Omitir configuraci√≥n de blacklist

**Ejemplo de configuraci√≥n personalizada:**
```bash
# Cuando se le solicite, ingrese dominios separados por comas:
facebook.com,twitter.com,youtube.com,netflix.com,tiktok.com
```
<a href="#readme-top"><img align="right" border="0" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/up_arrow.png" width="22" ></a>
---
### Instalaci√≥n Manual

1. Clonar el repositorio:
   ```bash
   mkdir -p /opt/squidstats
   git clone https://github.com/kaelthasmanu/SquidStats.git /opt/squidstats
   ```

2. Creaci√≥n de un ambiente virtual (venv):

```bash
 cd /opt/squidstats/
 python3 -m venv "/opt/squidstats/venv"
 source venv/bin/activate
 pip install --upgrade pip
```

3. Instalaci√≥n de los requerimientos de python con pip o pip3:

```bash
  pip install -r /opt/squidstats/requirements.txt
```

4. Crear un fichero .env en la ra√≠z del proyecto y agregar lo siguiente:\
    Nota: para usar MARIADB necesita tener corriendo su servidor de Bases de Datos.
   ```bash
   VERSION=2
   SQUID_HOST="127.0.0.1"
   SQUID_PORT=3128
   FLASK_DEBUG=True
   DATABASE_TYPE="SQLITE"
   SQUID_LOG="/var/log/squid/access.log"
   DATABASE_STRING_CONNECTION="/opt/SquidStats/"
   REFRESH_INTERVAL=60
   BLACKLIST_DOMAINS="facebook.com,twitter.com,instagram.com,tiktok.com,youtube.com,netflix.com"
   HTTP_PROXY=""
   ```

5. Ejecutar la aplicaci√≥n con python o python3 üöÄ:

```bash
  python3 app.py
```

6. En el navegador de su preferencia, visite el siguiente enlace:

```bash
  http://ip/hostname:5000 
```
### ‚ö†Ô∏è Alerta en la primera ejecuci√≥n ‚ö†Ô∏è

Advertencia: üö® La primera vez que se ejecuta puede causar un alto uso de la CPU.

### Actualizar el proyecto (web) con Script

1. Obtener el script con curl o wget:

```bash
 wget https://github.com/kaelthasmanu/SquidStats/releases/download/0.2/install.sh
``` 

2. Dar permisos de ejecuci√≥n:

```bash
 sudo chmod +x install.sh
```

3. Ejecutar el script con el par√°metro update:

```bash
 sudo ./install.sh --update
```

üïí **Ejecutar al iniciar el sistema operativo**

Para garantizar que la aplicaci√≥n se inicie autom√°ticamente cuando se inicia el sistema, agregue el siguiente trabajo al cron:

1. Abrir con un editor el fichero crontab

```bash
nano /etc/crontab
```

2. A√±adir la siguiente l√≠nea al fichero de crontab (cambiar path_app por su ruta):

```bash
@reboot root nohup python3 path_app/app.py &
```

3. Guardar

O puede usar servicios (daemon):

1. Copiar el fichero de servicio:

```bash
  cp ./utils/squidstats.service /etc/systemd/system/squidstats.service
```

2. Reiniciar daemons:

```bash
  systemctl daemon-reload
```

3. Activar el servicio:

```bash
  systemctl enable squidstats.service
```

4. Iniciar el servicio:

```bash
  systemctl start squidstats.service
```

## <a href="#readme-top"><img align="right" border="0" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/up_arrow.png" width="22" ></a>
## Informaci√≥n de Prueba

Este software ha sido probado exhaustivamente y es compatible con la versi√≥n 6.12 de Squid en Ubuntu 24.04 y Debian 12. Por favor aseg√∫rese de que su instalaci√≥n de Squid sea compatible con esta versi√≥n o una posterior para un rendimiento √≥ptimo.

## Por hacer
*Make blah blah.*

## Colaboradores

1. Hacer fork del repositorio:
   ```bash
   git checkout -b feature-name
   ```

2. Crear una nueva rama para tu funci√≥n o correcci√≥n:
   ```bash
   git checkout -b feature-name
   ```

3. Confirmar sus cambios y enviar la rama:
   ```bash
   git push origin feature-name
   ```

4. Abrir una solicitud de extracci√≥n (pull request).

**Colaboradores**
<table style="width:100%">
  <tr>
    <th><b>Kaelthas</b></th>
    <th><b>Alexminator</b></th>
  </tr>
  <tr>
    <td align="center"><a href="https://github.com/kaelthasmanu"><img src="https://avatars.githubusercontent.com/u/39976595?v=4" width=150px height=150px alt="kaelthasmanu"/></a></td>
    <td align="center"><a href="https://github.com/alexminator"><img src="https://avatars.githubusercontent.com/u/9116486?s=400&v=4" width=150px height=150px alt="alexminator"/></a></td>
  </tr>
  <tr>
    <td align="center"></a> <a href="https://www.linkedin.com/in/manuel-gorrin-095242238/"><img src="assets/linkedin-48.png" width="32px" height="32px"></a><a href="https://t.me/king_0f_deathhh"><img src="assets/telegram-app-48.png" width="32px" height="32px"></a></td>
    <td align="center"><a href="https://twitter.com/alexminator99"><img src="assets/x_48.png" width="32px" height="32px"></a> <a href="https://www.linkedin.com/in/alexander-rivas-73532037/"><img src="assets/linkedin-48.png" width="32px" height="32px"></a><a href="https://t.me/Alexminator"><img src="assets/telegram-app-48.png" width="32px" height="32px"></a></td>
  </tr>
</table>

## Licencia

*El proyecto SquidStats se publica bajo la licencia <a href="https://github.com/kaelthasmanu/SquidStats/blob/master/LICENSE.md">MIT</a>.*

<!-- CONTACT -->
## Contacto

> **_¬øNecesita ayuda?_** 
> **_Cont√°cteme üì® [manuelalberto.gorrin@gmail.com](mailto:manuelalberto.gorrin@gmail.com?Subject=SquidStats_issues)_**

Proyecto relacionado: ([CuCuota](https://github.com/kaelthasmanu/cucuota))

## Tecnolog√≠as Utilizadas

Backend: Python, Flask  
Frontend: HTML, CSS, JavaScript

## Agradecimientos Especiales

- _A la comunidad cubana de administradores de sistemas._
- _A todos los que me brindaron su ayuda cuando ten√≠a dudas._

## <a href="#readme-top"><img align="right" border="0" src="https://github.com/kaelthasmanu/SquidStats/blob/main/assets/up_arrow.png" width="22" ></a>
